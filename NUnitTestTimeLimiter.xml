<?xml version="1.0" encoding="utf-8"?>
<project name="NUnitTestTimeLimiter.xml" default="help" xmlns="http://nant.sf.net/release/0.92/nant.xsd">
  <description>Build file for NUnitTestTimeLimiter Fody weaver.</description>
  
  <property name="project.name" value="NUnitTestTimeLimiter"/>
  <include buildfile="../NAnt/ATZ.Build.xml"/>

  <target name="mergedlls">
    <property name="ilmerge" value="C:\Program Files (x86)\Microsoft\ILMerge\ILMerge.exe"/>
    <property name="weaver.name" value="NUnitTestTimeLimiter.Fody"/>
    <property name="build.dir" value="${solutiondir}/${weaver.name}/bin/Debug"/>

    <delete file="${build.dir}/${weaver.name}2.dll"/>
    <move file="${build.dir}/${weaver.name}.dll" tofile="${build.dir}/${weaver.name}2.dll"/>

    <exec workingdir="${build.dir}" program="${ilmerge}">
      <arg value="/targetplatform:v4"/>
      <arg value="/out:${weaver.name}.dll"/>
      <arg value="${weaver.name}2.dll"/>
      <arg value="JetBrains.Annotations.dll"/>
      <arg value="ATZ.CecilExtensions.dll"/>
      <arg value="/internalize"/>
    </exec>

    <call target="nuget"/>
  </target>
</project>
